import fs from "node:fs/promises"
import express from "express"

const isProduction = process.env.NODE_ENV === "production"
const port = process.env.PORT || 8080
const base = process.env.BASE || "/"


const templateHtml = isProduction
? await fs.readFile("./dist/client/index.html", "utf-8")
: ""


const app = express()


let vite
if (!isProduction) {
  const { createServer } = await import("vite")
  vite = await createServer({
    server: {middlewareMode: true},
    appType: "custom",
    base
  })
  app.use(vite.middlewares)
} else {
  const compression = ( await import('compression')).default
  const sirv = ( await import("sirv")).default
  app.use(compression())
  app.use(base, sirv("./dist/client", { extensions: []}))


  app.use("*all", async (req, res) => {
    try {
      const url = req.or
    }
  })
}

